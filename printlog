#!/usr/bin/env ruby
# Example usage in a directory with either a svn or git working directory
#   
#   printlog -l 300 -d stevei -f tabular_invoice -s 3/1/2008-3/31/2008 -v
#   printlog -c ~/Desktop/regular_april_invoice.txt -f tabular_invoice
#
require File.dirname(__FILE__) + "/_printlog/printlog"
require "tempfile"

switches = {
  :"-d" => :developer, :"-f" => :format, :"-l" => :limit,
  :"-s" => :dates, :"-v" => :verbose, :"-c" => :convert
}

print_options, options = {}, []
verbose = ARGV.delete("-v")

options << [ARGV.shift, ARGV.shift] while !ARGV.empty?
options.each {|(k, v)| print_options[switches[k.to_sym]] = v}

report = print_options[:convert].nil? ?
  Printlog.new(`pwd`, print_options).report :
  Printlog::Converter.new(File.read(print_options[:convert])).report(print_options[:format])
verbose ? puts(report) : `echo "#{report}" | mate -a`