#!/usr/bin/env ruby
require File.dirname(__FILE__) + "/_printlog/printlog"
require "tempfile"

switches = {
  :"-d" => :developer, :"-f" => :format, :"-l" => :limit,
  :"-d" => :dates, :"-v" => :verbose
}

options = []
options << [ARGV.shift, ARGV.shift] while !ARGV.empty?
  
print_options = options.inject({}) do |hash, k, v|
  hash[switches[k]] = v
  hash
end

verbose = print_options.delete(:verbose)
report = print_options[:convert].nil? ?
  Printlog.new(`pwd`, print_options).report :
  Printlog::Converter.new(File.read(print_options[:convert])).report(print_options[:format])
verbose ? puts(report) : `echo "#{report}" | mate -a`